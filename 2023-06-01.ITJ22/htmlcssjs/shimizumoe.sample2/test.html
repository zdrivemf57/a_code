<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>食材新規登録</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://kit.fontawesome.com/bff2254426.js" crossorigin="anonymous"></script>

</head>

<body>


    <div class="container">
        <div class="row">
            <!-- header -->

            <!-- header -->

            <!-- aside -->

            <!-- aside -->


            <main class="col-lg-9 col-md-8 col-sm-12">

                <div class="">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="top.html">TOP</a></li>
                            <li class="breadcrumb-item"><a href="">食材一覧</a></li>
                            <li class="breadcrumb-item active" aria-current="page">食材新規登録</li>
                        </ol>
                    </nav>
                </div>


                <h1>食材新規登録</h1>

                <div class="">
                    <!-- action：ファイルの送信先のURLを入力 -->
                    <form action="#" method="post" enctype="multipart/form-data">

                        <table class="table addIngredient" id="myTable1">
                            <tr>
                                <th class="ingNum" rowspan="14">#</th>
                                <th>食材:</th>
                                <td colspan="3">テキスト</td>
                                <td rowspan="14"><button type="button" onclick="deleteTableRow(this)">削除</button></td>
                                </td>
                            </tr>

                            <tr>
                                <td>食材カテゴリー：</td>
                                <td colspan="3">
                                    <select>
                                        <option value="1">1</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td class="agNum">：</td>
                                <td>
                                    <select>
                                        <option value="1">1</option>
                                    </select>
                                </td>
                                <td><button type="button" onclick="onDeleteButtonClick(this)">-</button></td>
                            </tr>
                            <tr>
                                <td class="agNum">：</td>
                                <td>
                                    <select>
                                        <option value="1">1</option>
                                    </select>
                                </td>
                                <td><button type="button" onclick="onDeleteButtonClick(this)">-</button></td>
                            </tr>
                            <tr>
                                <td colspan="4">
                                    <button type="button" onclick="addRow('myTable1')">+</button>
                                </td>
                            </tr>


                        </table>

                        <table class="table addIngredient" id="myTable2">
                            <tr>
                                <th class="ingNum" rowspan="14">#</th>
                                <th>食材:</th>
                                <td colspan="3">テキスト</td>
                                <td rowspan="14"><button type="button" onclick="deleteTableRow(this)">削除</button></td>
                                </td>
                            </tr>

                            <tr>
                                <td>食材カテゴリー：</td>
                                <td colspan="3">
                                    <select>
                                        <option value="1">1</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td class="agNum">：</td>
                                <td>
                                    <select>
                                        <option value="1">1</option>
                                    </select>
                                </td>
                                <td><button type="button" onclick="onDeleteButtonClick(this)">-</button></td>
                            </tr>
                            <tr>
                                <td class="agNum">：</td>
                                <td>
                                    <select>
                                        <option value="1">1</option>
                                    </select>
                                </td>
                                <td><button type="button" onclick="onDeleteButtonClick(this)">-</button></td>
                            </tr>
                            <tr>
                                <td colspan="4">
                                    <button type="button" onclick="addRow('myTable2')">+</button>
                                </td>
                            </tr>


                        </table>



                        <div>
                            <button type="button" class="btn-clone">+ テーブル追加</button>
                            <input type="submit" value="食材登録" class="btn-addOrder">
                        </div>


                    </form>
                </div>
            </main>

            <!-- footer -->

            <!-- footer -->

        </div>
    </div>

<template id="tTable">
    <table class="table addIngredient" id="myTable1">
        <tr>
            <th class="ingNum" rowspan="14">#</th>
            <th>食材:</th>
            <td colspan="3">テキスト</td>
            <td rowspan="14"><button type="button" onclick="deleteTableRow(this)">削除</button></td>
            </td>
        </tr>

        <tr>
            <td>食材カテゴリー：</td>
            <td colspan="3">
                <select>
                    <option value="1">1</option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="agNum">：</td>
            <td>
                <select>
                    <option value="1">1</option>
                </select>
            </td>
            <td><button type="button" onclick="onDeleteButtonClick(this)">-</button></td>
        </tr>
        <tr>
            <td class="agNum">：</td>
            <td>
                <select>
                    <option value="1">1</option>
                </select>
            </td>
            <td><button type="button" onclick="onDeleteButtonClick(this)">-</button></td>
        </tr>
        <tr>
            <td colspan="4">
                <button type="button" onclick="addRow('myTable1')">+</button>
            </td>
        </tr>


    </table>
</template>



    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>


    <script>

        var maxRows = 13; // 追加可能な最大行数

        function addRow(tableId) {
            var table = document.getElementById(tableId);
            var rowCount = table.rows.length;

            if (rowCount < maxRows) {
                var newRow = table.insertRow(rowCount - 1); // 最後から2番目に新しい行を挿入

                var cell1 = newRow.insertCell(0);
                var cell2 = newRow.insertCell(1);
                var cell3 = newRow.insertCell(2);

                // 新しい行のセルにコンテンツを追加
                cell1.innerHTML = '<td></td>';
                cell1.className = "agNum";
                cell1.innerHTML = "：";
                cell2.innerHTML = '<td><select><option value="1">1</option></select></td>';
                cell3.innerHTML = '<td><button type="button" onclick="onDeleteButtonClick(this)">-</button></td>';
            } else {
                alert("最大行数に達しました。");
            }
        }


        function onDeleteButtonClick(button) {
            var row = button.parentElement.parentElement; // ボタンの親要素（tr要素）を取得
            var table = row.parentElement; // テーブルを取得
            table.deleteRow(row.rowIndex); // 行を削除
        }

        var cloneButton = document.querySelector('.btn-clone');


        cloneButton.addEventListener('click', function () {
            // 直前の要素（テーブル）を取得
            // var originalTable = this.parentNode.previousElementSibling;
            // var newTable = originalTable.cloneNode(true);

            // 新しいテーブルのIDを変更してユニークにする
            // var newTableId = "myTable" + (parseInt(originalTable.getAttribute('id').replace(/\D/g, '')) + 1);
            // newTable.setAttribute('id', newTableId);
            
            // 新しいテーブルのonclickのIDを変更してユニークにする
            // newTable.querySelector("tr:last-child td button").setAttribute('onclick', "addRow('" + newTableId + "')");
            
            // 新しいテーブルを追加
            // originalTable.parentElement.insertBefore(newTable, originalTable.nextSibling);
            
            // 直前の要素（テーブル）を取得
            let originalTable = this.parentNode.previousElementSibling;

            // テンプレートからテーブルを複製
            let content = document.getElementById('tTable').content.cloneNode(true);
            
            // 新しいテーブルのIDを変更してユニークにする
            var newTableId = "myTable" + (parseInt(originalTable.getAttribute('id').replace(/\D/g, '')) + 1);
            content.querySelector("table").setAttribute('id', newTableId);

            // 新しいテーブルのonclickのIDを変更してユニークにする
            content.querySelector("tr:last-child td button").setAttribute('onclick', "addRow('" + newTableId + "')");

            // 新しいテーブルを追加
            originalTable.parentElement.insertBefore(content, originalTable.nextSibling);

        });

        function deleteTableRow(button) {
            var table = button.closest('.table.addIngredient');
            var container = table.parentElement;

            // 最後のテーブルの場合は削除しない
            if (document.querySelectorAll('.table.addIngredient').length > 1) {
                container.removeChild(table);
            } else {
                alert("最後のテーブルは削除できません。");
            }
        }




    </script>


</body>

</html>