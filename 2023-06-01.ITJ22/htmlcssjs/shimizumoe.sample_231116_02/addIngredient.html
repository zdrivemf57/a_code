<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://kit.fontawesome.com/bff2254426.js" crossorigin="anonymous"></script>
    <title>ADD INGREDIENT</title>
</head>

<body>

    <div class="sticky-top">

        <!-- SP版ハンバーガーメニュー -->
        <div class="hum">
            <div class="navbar navbar-expand-lg d-lg-none">
                <div class="container-fluid">
                    <a class="navbar-brand" href="top.html">SETTING</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                        data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">


            <!-- サイドメニュー（PC版） -->
            <nav id="sidebar" class="col-lg-3 position-fixed d-none d-lg-block">
                <div class="container">

                    <div class="sidebar-header">
                        <h2 class="my-3">
                            <a class="navbar-brand" href="top.html">SETTING</a>
                        </h2>
                    </div>

                    <div class="sidebar1">
                        <ul class="nav nav-pills flex-column">
                            <li class="disabled">
                                <a class="nav-link disabled">商品</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">商品一覧</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">商品新規登録</a>
                            </li>
                        </ul>
                    </div>
                    <div class="sidebar2 mt-3">
                        <ul class="nav nav-pills flex-column">
                            <li class="disabled">
                                <a class="nav-link disabled">食材</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="#">食材一覧</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="test3..html">食材新規登録</a>
                            </li>
                        </ul>
                    </div>

                    <div class="sidebar3 mt-3">
                        <ul class="nav nav-pills flex-column">
                            <li class="disabled">
                                <a class="nav-link disabled">アレルギー</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="#">アレルギー一覧</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="test3..html">アレルギー新規登録</a>
                            </li>
                        </ul>
                    </div>
                    <div class="sidebar4 mt-3">
                        <ul class="nav nav-pills flex-column">
                            <li class="disabled">
                                <a class="nav-link disabled">食品カテゴリー</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" aria-current="page" href="#">食品カテゴリー一覧</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="test3..html">食品カテゴリー新規登録</a>
                            </li>
                        </ul>
                    </div>



                    <div class="dropdown">
                        <a href="#"
                            class="d-flex align-items-center link-body-emphasis text-decoration-none dropdown-toggle"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="https://github.com/mdo.png" alt="" width="32" height="32"
                                class="rounded-circle me-2">
                            <strong>mdo</strong>
                        </a>
                        <ul class="dropdown-menu text-small shadow">
                            <li><a class="dropdown-item" href="#">新プロジェクト...</a></li>
                            <li><a class="dropdown-item" href="#">設定</a></li>
                            <li><a class="dropdown-item" href="#">プロフィール</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">サインアウト</a></li>
                        </ul>
                    </div>



                </div>
            </nav>
        </div>



        <div class="container-fluid">
            <div class="row">


                <!-- メインコンテンツ -->
                <main class="col-lg-9 p-lg-5 offset-lg-3">
                    <form action="#" method="post" enctype="multipart/form-data">
                        <div class="container">

                            <h1 class=""> 新規食材登録</h1>


                            <table class="table addIngredient" id="myTable1">
                                <tr>
                                    <th class="ingNum" rowspan="14"></th>
                                    <th>食材:</th>
                                    <td colspan="3"><input type="text"></td>
                                    <td rowspan="14"><button type="button" onclick="deleteTableRow(this)"
                                            class="btn-remove">dele</button>
                                    </td>
                                </tr>

                                <tr>
                                    <td>食材カテゴリー：</td>
                                    <td colspan="3">
                                        <select>
                                            <option value="1">1</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="agNum">：</td>
                                    <td>
                                        <select>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </td>
                                    <td><button type="button" onclick="onDeleteButtonClick(this)"
                                            class="btn-allergyMinus">-</button></td>
                                </tr>
                                <tr>
                                    <td class="agNum">：</td>
                                    <td>
                                        <select>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </td>
                                    <td><button type="button" onclick="onDeleteButtonClick(this)"
                                            class="btn-allergyMinus">-</button></td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <button type="button" onclick="addRow('myTable1')"
                                            class="btn-allergyPlus">+</button>
                                    </td>
                                </tr>


                            </table>


                            <table class="table addIngredient" id="myTable2">
                                <tr>
                                    <th class="ingNum" rowspan="14"></th>
                                    <th>食材:</th>
                                    <td colspan="3"><input type="text"></td>
                                    <td rowspan="14"><button type="button" onclick="deleteTableRow(this)"
                                            class="btn-remove">dele</button>
                                    </td>
                                </tr>

                                <tr>
                                    <td>食材カテゴリー：</td>
                                    <td colspan="3">
                                        <select>
                                            <option value="1">1</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="agNum">：</td>
                                    <td>
                                        <select>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </td>
                                    <td><button type="button" onclick="onDeleteButtonClick(this)"
                                            class="btn-allergyMinus">-</button></td>
                                </tr>
                                <tr>
                                    <td class="agNum">：</td>
                                    <td>
                                        <select>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </td>
                                    <td><button type="button" onclick="onDeleteButtonClick(this)"
                                            class="btn-allergyMinus">-</button></td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <button type="button" onclick="addRow('myTable2')"
                                            class="btn-allergyPlus">+</button>
                                    </td>
                                </tr>

                            </table>


                            <div class="d-flex justify-content-between">

                                <input type="submit" value="新規登録" class="btn-add">

                                <a href="#">
                                    <button type="button" class="btn-clone">+ テーブル追加</button>
                                </a>

                            </div>


                        </div>


                    </form>
                </main>
            </div>

        </div>
    </div>



    <template id="tTable">

        <table class="table addIngredient" id="myTable2">
            <tr>
                <th class="ingNum" rowspan="14"></th>
                <th>食材:</th>
                <td colspan="3"><input type="text"></td>
                <td rowspan="14"><button type="button" onclick="deleteTableRow(this)" class="btn-remove">dele</button>
                </td>
            </tr>

            <tr>
                <td>食材カテゴリー：</td>
                <td colspan="3">
                    <select>
                        <option value="1">1</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="agNum">：</td>
                <td>
                    <select>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </td>
                <td><button type="button" onclick="onDeleteButtonClick(this)" class="btn-allergyMinus">-</button></td>
            </tr>
            <tr>
                <td class="agNum">：</td>
                <td>
                    <select>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </td>
                <td><button type="button" onclick="onDeleteButtonClick(this)" class="btn-allergyMinus">-</button></td>
            </tr>
            <tr>
                <td colspan="4">
                    <button type="button" onclick="addRow('myTable2')" class="btn-allergyPlus">+</button>
                </td>
            </tr>

        </table>
    </template>


    <!-- 右側から表示されるOffcanvasメニュー -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasRightLabel">Offcanvas right</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <!-- Offcanvasメニューの内容をここに追加 -->
            <ul class="navbar-nav">
                <li class="disabled">
                    <a class="nav-link disabled">商品</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">商品一覧</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="test3..html">商品新規登録</a>
                </li>

                <li class="disabled">
                    <a class="nav-link disabled">食材</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="#">食材一覧</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">食材新規登録</a>
                </li>

                <li class="disabled">
                    <a class="nav-link disabled">アレルギー</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="#">アレルギー一覧</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">アレルギー新規登録</a>
                </li>

                <li class="disabled">
                    <a class="nav-link disabled">食品カテゴリー</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="#">食品カテゴリー一覧</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">食品カテゴリー新規登録</a>
                </li>


            </ul>

            <div class="dropdown">
                <a href="#" class="d-flex align-items-center link-body-emphasis text-decoration-none dropdown-toggle"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="https://github.com/mdo.png" alt="" width="32" height="32" class="rounded-circle me-2">
                    <strong>mdo</strong>
                </a>
                <ul class="dropdown-menu text-small shadow">
                    <li><a class="dropdown-item" href="#">新プロジェクト...</a></li>
                    <li><a class="dropdown-item" href="#">設定</a></li>
                    <li><a class="dropdown-item" href="#">プロフィール</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="#">サインアウト</a></li>
                </ul>
            </div>


        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        // アレルギー項目行追加処理
        var maxRows = 13; // 追加可能な最大行数

        function addRow(tableId) {
            var table = document.getElementById(tableId);
            var rowCount = table.rows.length;

            if (rowCount < maxRows) {
                var newRow = table.insertRow(rowCount - 1); // 最後から2番目に新しい行を挿入

                var cell1 = newRow.insertCell(0);
                var cell2 = newRow.insertCell(1);
                var cell3 = newRow.insertCell(2);

                // 新しい行のセルにコンテンツを追加
                cell1.className = "agNum";
                cell1.innerHTML = "：";
                cell2.innerHTML = '<td><select><option value="1">1</option><option value="2">2</option><option value="3">3</option></td>';
                cell3.innerHTML = '<td><button type="button" onclick="onDeleteButtonClick(this)" class="btn-allergyMinus">-</button></td>';
            } else {
                alert("最大行数に達しました。");
            }
        }

        // アレルギー項目行削除処理
        function onDeleteButtonClick(button) {
            var row = button.parentElement.parentElement; // ボタンの親要素（tr要素）を取得
            var table = row.parentElement; // テーブルを取得
            table.deleteRow(row.rowIndex); // 行を削除
        }


        // テーブル追加処理
        // HTML内の全てのボタンを取得
        var cloneButton = document.querySelector('.btn-clone');

        // ボタンがクリックされたときの処理を定義

        cloneButton.addEventListener('click', function () {

            // 直前の要素（テーブル）を取得

            let originalTable = this.parentNode.parentNode.previousElementSibling;
            console.log(this)
            console.log(this.parentNode)
            console.log(originalTable)



            // テンプレートからテーブルを複製

            let content = document.getElementById('tTable').content.cloneNode(true);



            // 新しいテーブルのIDを変更してユニークにする

            var newTableId = "myTable" + (parseInt(originalTable.getAttribute('id').replace(/\D/g, '')) + 1);

            content.querySelector("table").setAttribute('id', newTableId);



            // 新しいテーブルのonclickのIDを変更してユニークにする

            content.querySelector("tr:last-child td button").setAttribute('onclick', "addRow('" + newTableId + "')");



            // 新しいテーブルを追加

            originalTable.parentElement.insertBefore(content, originalTable.nextSibling);

        });

        // テーブル連番処理
        $(document).ready(function () {
            function updateTableCount() {
                var tables = $('table');

                // テーブルの数をカウント
                var tableCount = tables.length;

                // 各 .ingNum に連番を振り直す
                $('.ingNum').each(function (index) {
                    $(this).html(index + 1);
                });
            }

            // ページ読み込み時に初回のテーブルカウントと連番振りを行う
            updateTableCount();

            // テーブル追加ボタンがクリックされたときの処理
            $('.btn-clone').on('click', function () {
                // テーブルを追加する処理（適切な処理を実装する）

                // テーブルを追加した後にテーブルのカウントと連番を振り直す
                updateTableCount();
            });



        });

        // テーブル削除処理
        function deleteTableRow(button) {
            var table = button.closest('.table.addIngredient');
            var container = table.parentElement;

            // 最後のテーブルの場合は削除しない
            if (document.querySelectorAll('.table.addIngredient').length > 1) {
                container.removeChild(table);

                // テーブルを削除した後にテーブルのカウントと連番を振り直す
                updateTableCount();
            } else {
                alert("最後のテーブルは削除できません。");
            }
        }

        // テーブル削除処理後の連番振り直し処理
        function updateTableCount() {
            var tables = document.querySelectorAll('.table.addIngredient');

            // 各テーブルに連番を振り直す
            tables.forEach(function (table, index) {

                // 更新された連番を .ingNum にも反映
                var ingNumElement = table.querySelector('.ingNum');
                if (ingNumElement) {
                    ingNumElement.textContent = index + 1;
                }
            });
        }

    </script>
</body>

</html>